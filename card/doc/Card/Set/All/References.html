<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Card::Set::All::References
  
    &mdash; Documentation by YARD 0.9.5
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Card::Set::All::References";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Card.html" title="Card (class)">Card</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Set.html" title="Card::Set (module)">Set</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../All.html" title="Card::Set::All (class)">All</a></span></span>
     &raquo; 
    <span class="title">References</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="../../../class_list.html"></iframe>

      <div id="content"><h1>Module: Card::Set::All::References
  
  
  
</h1>
<div class="box_info">
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd><span class='object_link'><a href="../../Set.html" title="Card::Set (module)">Card::Set</a></span></dd>
  </dl>
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>tmpsets/set/mod001-core/all/references.rb</dd>
  </dl>
  
</div>


  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="PARTIAL_REF_CODE-constant" class="">PARTIAL_REF_CODE =
        <div class="docstring">
  <div class="discussion">
    
<p>Cards can refer to other cards in their content, eg via links and nests.
The card that refers is the “referer”, the card that is referred to is the
“referee”. The reference itself has its own class (Card::Reference), which
handles id-based reference tracking.</p>


  </div>
</div>
<div class="tags">
  

</div>
      </dt>
      <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>P</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
    
  </dl>







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_references_out-instance_method" title="#create_references_out (instance method)">#<strong>create_references_out</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>interpret references from this card&#39;s content and insert entries in
reference table.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_references_out-instance_method" title="#delete_references_out (instance method)">#<strong>delete_references_out</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>delete references from this card.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each_reference_out-instance_method" title="#each_reference_out (instance method)">#<strong>each_reference_out</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>invokes the given block for each reference in raw_content with the
reference name and reference type.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#family_referers-instance_method" title="#family_referers (instance method)">#<strong>family_referers</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>cards that refer to self or any descendant.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#includees-instance_method" title="#includees (instance method)">#<strong>includees</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>cards that self includes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#includers-instance_method" title="#includers (instance method)">#<strong>includers</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>cards that include self.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#interpret_partial_references-instance_method" title="#interpret_partial_references (instance method)">#<strong>interpret_partial_references</strong>(ref_hash, referee_name)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Partial references are needed to track references to virtual cards.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#interpret_reference-instance_method" title="#interpret_reference (instance method)">#<strong>interpret_reference</strong>(ref_hash, referee_name, ref_type)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>interpretation phase helps to prevent duplicate references results in hash
like: { referee1_key: [referee1_id, referee1_type1, referee1_type2],  
referee2_key… }.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#name_referers-instance_method" title="#name_referers (instance method)">#<strong>name_referers</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>cards that refer to self by name (finds cards not yet linked by id).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#referees-instance_method" title="#referees (instance method)">#<strong>referees</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>cards that self refers to.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reference_values_array-instance_method" title="#reference_values_array (instance method)">#<strong>reference_values_array</strong>(ref_hash)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>translate interpreted reference hash into values array, removing duplicate
and unnecessary ref_types.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#referers-instance_method" title="#referers (instance method)">#<strong>referers</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>cards that refer to self.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#replace_reference_syntax-instance_method" title="#replace_reference_syntax (instance method)">#<strong>replace_reference_syntax</strong>(old_name, new_name)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>replace references in card content.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_references_out-instance_method" title="#update_references_out (instance method)">#<strong>update_references_out</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>delete old references from this card&#39;s content, create new ones.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Loader.html" title="Card::Set::Loader (module)">Loader</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Loader.html#clean_empty_module_from_hash-instance_method" title="Card::Set::Loader#clean_empty_module_from_hash (method)">#clean_empty_module_from_hash</a></span>, <span class='object_link'><a href="../Loader.html#clean_empty_modules-instance_method" title="Card::Set::Loader#clean_empty_modules (method)">#clean_empty_modules</a></span>, <span class='object_link'><a href="../Loader.html#extended-instance_method" title="Card::Set::Loader#extended (method)">#extended</a></span>, <span class='object_link'><a href="../Loader.html#pattern_and_modules_from_path-instance_method" title="Card::Set::Loader#pattern_and_modules_from_path (method)">#pattern_and_modules_from_path</a></span>, <span class='object_link'><a href="../Loader.html#process_base_modules-instance_method" title="Card::Set::Loader#process_base_modules (method)">#process_base_modules</a></span>, <span class='object_link'><a href="../Loader.html#register_set-instance_method" title="Card::Set::Loader#register_set (method)">#register_set</a></span>, <span class='object_link'><a href="../Loader.html#tmp_file_template-instance_method" title="Card::Set::Loader#tmp_file_template (method)">#tmp_file_template</a></span>, <span class='object_link'><a href="../Loader.html#write_tmp_file-instance_method" title="Card::Set::Loader#write_tmp_file (method)">#write_tmp_file</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Helpers.html" title="Card::Set::Helpers (module)">Helpers</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Helpers.html#abstract_set%3F-instance_method" title="Card::Set::Helpers#abstract_set? (method)">#abstract_set?</a></span>, <span class='object_link'><a href="../Helpers.html#all_set%3F-instance_method" title="Card::Set::Helpers#all_set? (method)">#all_set?</a></span>, <span class='object_link'><a href="../Helpers.html#shortname-instance_method" title="Card::Set::Helpers#shortname (method)">#shortname</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../AdvancedApi.html" title="Card::Set::AdvancedApi (module)">Card::Set::AdvancedApi</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../AdvancedApi.html#attachment-instance_method" title="Card::Set::AdvancedApi#attachment (method)">#attachment</a></span>, <span class='object_link'><a href="../AdvancedApi.html#ensure_set-instance_method" title="Card::Set::AdvancedApi#ensure_set (method)">#ensure_set</a></span>, <span class='object_link'><a href="../AdvancedApi.html#stage_method-instance_method" title="Card::Set::AdvancedApi#stage_method (method)">#stage_method</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Format.html" title="Card::Set::Format (module)">Format</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Format.html#all_set_format_mod%21-instance_method" title="Card::Set::Format#all_set_format_mod! (method)">#all_set_format_mod!</a></span>, <span class='object_link'><a href="../Format.html#define_on_format-instance_method" title="Card::Set::Format#define_on_format (method)">#define_on_format</a></span>, <span class='object_link'><a href="../Format.html#format-instance_method" title="Card::Set::Format#format (method)">#format</a></span>, <span class='object_link'><a href="../Format.html#register_set_format-instance_method" title="Card::Set::Format#register_set_format (method)">#register_set_format</a></span>, <span class='object_link'><a href="../Format.html#view-instance_method" title="Card::Set::Format#view (method)">#view</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Inheritance.html" title="Card::Set::Inheritance (module)">Inheritance</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Inheritance.html#include_set-instance_method" title="Card::Set::Inheritance#include_set (method)">#include_set</a></span>, <span class='object_link'><a href="../Inheritance.html#include_set_formats-instance_method" title="Card::Set::Inheritance#include_set_formats (method)">#include_set_formats</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Basket.html" title="Card::Set::Basket (module)">Basket</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Basket.html#abstract_basket-instance_method" title="Card::Set::Basket#abstract_basket (method)">#abstract_basket</a></span>, <span class='object_link'><a href="../Basket.html#add_to_basket-instance_method" title="Card::Set::Basket#add_to_basket (method)">#add_to_basket</a></span>, <span class='object_link'><a href="../Basket.html#basket-instance_method" title="Card::Set::Basket#basket (method)">#basket</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Trait.html" title="Card::Set::Trait (module)">Trait</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Trait.html#card_accessor-instance_method" title="Card::Set::Trait#card_accessor (method)">#card_accessor</a></span>, <span class='object_link'><a href="../Trait.html#card_reader-instance_method" title="Card::Set::Trait#card_reader (method)">#card_reader</a></span>, <span class='object_link'><a href="../Trait.html#card_writer-instance_method" title="Card::Set::Trait#card_writer (method)">#card_writer</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Event.html" title="Card::Set::Event (module)">Event</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Event.html#event-instance_method" title="Card::Set::Event#event (method)">#event</a></span></p>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create_references_out-instance_method">
  
    #<strong>create_references_out</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>interpret references from this card&#39;s content and insert entries in
reference table</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


69
70
71
72
73
74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 69</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_references_out'>create_references_out</span>
  <span class='id identifier rubyid_ref_hash'>ref_hash</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_each_reference_out'>each_reference_out</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_referee_name'>referee_name</span><span class='comma'>,</span> <span class='id identifier rubyid_ref_type'>ref_type</span><span class='op'>|</span>
    <span class='id identifier rubyid_interpret_reference'>interpret_reference</span> <span class='id identifier rubyid_ref_hash'>ref_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_referee_name'>referee_name</span><span class='comma'>,</span> <span class='id identifier rubyid_ref_type'>ref_type</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_ref_hash'>ref_hash</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='const'>Card</span><span class='op'>::</span><span class='const'>Reference</span><span class='period'>.</span><span class='id identifier rubyid_mass_insert'>mass_insert</span> <span class='id identifier rubyid_reference_values_array'>reference_values_array</span><span class='lparen'>(</span><span class='id identifier rubyid_ref_hash'>ref_hash</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_references_out-instance_method">
  
    #<strong>delete_references_out</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>delete references from this card</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 79</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_references_out'>delete_references_out</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id required to delete references</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='const'>Card</span><span class='op'>::</span><span class='const'>Reference</span><span class='period'>.</span><span class='id identifier rubyid_delete_all'>delete_all</span> <span class='label'>referer_id:</span> <span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="each_reference_out-instance_method">
  
    #<strong>each_reference_out</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>invokes the given block for each reference in raw_content with the
reference name and reference type</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 128</span>

<span class='kw'>def</span> <span class='id identifier rubyid_each_reference_out'>each_reference_out</span>
  <span class='id identifier rubyid_content_obj'>content_obj</span> <span class='op'>=</span> <span class='const'>Card</span><span class='op'>::</span><span class='const'>Content</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_raw_content'>raw_content</span><span class='comma'>,</span> <span class='kw'>self</span>
  <span class='id identifier rubyid_content_obj'>content_obj</span><span class='period'>.</span><span class='id identifier rubyid_find_chunks'>find_chunks</span><span class='lparen'>(</span><span class='const'>Card</span><span class='op'>::</span><span class='const'>Content</span><span class='op'>::</span><span class='const'>Chunk</span><span class='op'>::</span><span class='const'>Reference</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_chunk'>chunk</span><span class='op'>|</span>
    <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_chunk'>chunk</span><span class='period'>.</span><span class='id identifier rubyid_referee_name'>referee_name</span><span class='comma'>,</span> <span class='id identifier rubyid_chunk'>chunk</span><span class='period'>.</span><span class='id identifier rubyid_reference_code'>reference_code</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="family_referers-instance_method">
  
    #<strong>family_referers</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>cards that refer to self or any descendant</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 42</span>

<span class='kw'>def</span> <span class='id identifier rubyid_family_referers'>family_referers</span>
  <span class='ivar'>@family_referers</span> <span class='op'>||=</span> <span class='lparen'>(</span><span class='lbracket'>[</span><span class='kw'>self</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_descendants'>descendants</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:referers</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
  <span class='comment'># FIXME: could be much more efficient!
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="includees-instance_method">
  
    #<strong>includees</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>cards that self includes</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 30</span>

<span class='kw'>def</span> <span class='id identifier rubyid_includees'>includees</span>
  <span class='id identifier rubyid_refs'>refs</span> <span class='op'>=</span> <span class='id identifier rubyid_references_out'>references_out</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>ref_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_refs'>refs</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ref'>ref</span><span class='op'>|</span> <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_ref'>ref</span><span class='period'>.</span><span class='id identifier rubyid_referee_key'>referee_key</span><span class='comma'>,</span> <span class='label'>new:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="includers-instance_method">
  
    #<strong>includers</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>cards that include self</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_includers'>includers</span>
  <span class='id identifier rubyid_refs'>refs</span> <span class='op'>=</span> <span class='id identifier rubyid_references_in'>references_in</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>ref_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_refs'>refs</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:referer_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:fetch</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="interpret_partial_references-instance_method">
  
    #<strong>interpret_partial_references</strong>(ref_hash, referee_name)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Partial references are needed to track references to virtual cards. For
example a link to virual card [[A+*self]] won&#39;t have a referee_id, but
when A&#39;s name is changed we have to find and update that link.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 104</span>

<span class='kw'>def</span> <span class='id identifier rubyid_interpret_partial_references'>interpret_partial_references</span> <span class='id identifier rubyid_ref_hash'>ref_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_referee_name'>referee_name</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_referee_name'>referee_name</span><span class='period'>.</span><span class='id identifier rubyid_left'>left</span><span class='comma'>,</span> <span class='id identifier rubyid_referee_name'>referee_name</span><span class='period'>.</span><span class='id identifier rubyid_right'>right</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sidename'>sidename</span><span class='op'>|</span>
    <span class='id identifier rubyid_interpret_reference'>interpret_reference</span> <span class='id identifier rubyid_ref_hash'>ref_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_sidename'>sidename</span><span class='comma'>,</span> <span class='const'>PARTIAL_REF_CODE</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="interpret_reference-instance_method">
  
    #<strong>interpret_reference</strong>(ref_hash, referee_name, ref_type)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>interpretation phase helps to prevent duplicate references results in hash
like: { referee1_key: [referee1_id, referee1_type1, referee1_type2],</p>

<pre class="code ruby"><code class="ruby">referee2_key...</code></pre>

<p>}</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


89
90
91
92
93
94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 89</span>

<span class='kw'>def</span> <span class='id identifier rubyid_interpret_reference'>interpret_reference</span> <span class='id identifier rubyid_ref_hash'>ref_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_referee_name'>referee_name</span><span class='comma'>,</span> <span class='id identifier rubyid_ref_type'>ref_type</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_referee_name'>referee_name</span> <span class='comment'># eg commented nest has no referee_name
</span>  <span class='id identifier rubyid_referee_key'>referee_key</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_referee_name'>referee_name</span> <span class='op'>=</span> <span class='id identifier rubyid_referee_name'>referee_name</span><span class='period'>.</span><span class='id identifier rubyid_to_name'>to_name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_referee_key'>referee_key</span> <span class='op'>==</span> <span class='id identifier rubyid_key'>key</span> <span class='comment'># don&#39;t create self reference
</span>
  <span class='id identifier rubyid_referee_id'>referee_id</span> <span class='op'>=</span> <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_fetch_id'>fetch_id</span><span class='lparen'>(</span><span class='id identifier rubyid_referee_name'>referee_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ref_hash'>ref_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_referee_key'>referee_key</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_referee_id'>referee_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_ref_hash'>ref_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_referee_key'>referee_key</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ref_type'>ref_type</span>

  <span class='id identifier rubyid_interpret_partial_references'>interpret_partial_references</span> <span class='id identifier rubyid_ref_hash'>ref_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_referee_name'>referee_name</span> <span class='kw'>unless</span> <span class='id identifier rubyid_referee_id'>referee_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="name_referers-instance_method">
  
    #<strong>name_referers</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>cards that refer to self by name (finds cards not yet linked by id)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 37</span>

<span class='kw'>def</span> <span class='id identifier rubyid_name_referers'>name_referers</span>
  <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:references_out</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span> <span class='label'>card_references:</span> <span class='lbrace'>{</span> <span class='label'>referee_key:</span> <span class='id identifier rubyid_key'>key</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="referees-instance_method">
  
    #<strong>referees</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>cards that self refers to</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_referees'>referees</span>
  <span class='id identifier rubyid_references_out'>references_out</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ref'>ref</span><span class='op'>|</span> <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_ref'>ref</span><span class='period'>.</span><span class='id identifier rubyid_referee_key'>referee_key</span><span class='comma'>,</span> <span class='label'>new:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reference_values_array-instance_method">
  
    #<strong>reference_values_array</strong>(ref_hash)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>translate interpreted reference hash into values array, removing duplicate
and unnecessary ref_types</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


112
113
114
115
116
117
118
119
120
121
122
123
124</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 112</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reference_values_array'>reference_values_array</span> <span class='id identifier rubyid_ref_hash'>ref_hash</span>
  <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_ref_hash'>ref_hash</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_referee_key'>referee_key</span><span class='comma'>,</span> <span class='id identifier rubyid_hash_val'>hash_val</span><span class='op'>|</span>
    <span class='id identifier rubyid_referee_id'>referee_id</span> <span class='op'>=</span> <span class='id identifier rubyid_hash_val'>hash_val</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>null</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_ref_types'>ref_types</span> <span class='op'>=</span> <span class='id identifier rubyid_hash_val'>hash_val</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
    <span class='id identifier rubyid_ref_types'>ref_types</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='const'>PARTIAL_REF_CODE</span> <span class='kw'>if</span> <span class='id identifier rubyid_ref_types'>ref_types</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
    <span class='comment'># partial references are not necessary if there are explicit references
</span>    <span class='id identifier rubyid_ref_types'>ref_types</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ref_type'>ref_type</span><span class='op'>|</span>
      <span class='id identifier rubyid_values'>values</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_referee_id'>referee_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_referee_key'>referee_key</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ref_type'>ref_type</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_values'>values</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="referers-instance_method">
  
    #<strong>referers</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>cards that refer to self</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


14
15
16</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 14</span>

<span class='kw'>def</span> <span class='id identifier rubyid_referers'>referers</span>
  <span class='id identifier rubyid_references_in'>references_in</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:referer_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:fetch</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="replace_reference_syntax-instance_method">
  
    #<strong>replace_reference_syntax</strong>(old_name, new_name)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>replace references in card content</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50
51
52
53
54
55
56
57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_replace_reference_syntax'>replace_reference_syntax</span> <span class='id identifier rubyid_old_name'>old_name</span><span class='comma'>,</span> <span class='id identifier rubyid_new_name'>new_name</span>
  <span class='id identifier rubyid_obj_content'>obj_content</span> <span class='op'>=</span> <span class='const'>Card</span><span class='op'>::</span><span class='const'>Content</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_raw_content'>raw_content</span><span class='comma'>,</span> <span class='kw'>self</span>
  <span class='id identifier rubyid_obj_content'>obj_content</span><span class='period'>.</span><span class='id identifier rubyid_find_chunks'>find_chunks</span><span class='lparen'>(</span><span class='const'>Card</span><span class='op'>::</span><span class='const'>Content</span><span class='op'>::</span><span class='const'>Chunk</span><span class='op'>::</span><span class='const'>Reference</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_chunk'>chunk</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_old_ref_name'>old_ref_name</span> <span class='op'>=</span> <span class='id identifier rubyid_chunk'>chunk</span><span class='period'>.</span><span class='id identifier rubyid_referee_name'>referee_name</span><span class='rparen'>)</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_new_ref_name'>new_ref_name</span> <span class='op'>=</span> <span class='id identifier rubyid_old_ref_name'>old_ref_name</span><span class='period'>.</span><span class='id identifier rubyid_replace_part'>replace_part</span> <span class='id identifier rubyid_old_name'>old_name</span><span class='comma'>,</span> <span class='id identifier rubyid_new_name'>new_name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chunk'>chunk</span><span class='period'>.</span><span class='id identifier rubyid_referee_name'>referee_name</span> <span class='op'>=</span> <span class='id identifier rubyid_chunk'>chunk</span><span class='period'>.</span><span class='id identifier rubyid_replace_reference'>replace_reference</span> <span class='id identifier rubyid_old_name'>old_name</span><span class='comma'>,</span> <span class='id identifier rubyid_new_name'>new_name</span>
    <span class='id identifier rubyid_refs'>refs</span> <span class='op'>=</span> <span class='const'>Card</span><span class='op'>::</span><span class='const'>Reference</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span> <span class='label'>referee_key:</span> <span class='id identifier rubyid_old_ref_name'>old_ref_name</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>
    <span class='id identifier rubyid_refs'>refs</span><span class='period'>.</span><span class='id identifier rubyid_update_all'>update_all</span> <span class='label'>referee_key:</span> <span class='id identifier rubyid_new_ref_name'>new_ref_name</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_obj_content'>obj_content</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_references_out-instance_method">
  
    #<strong>update_references_out</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>delete old references from this card&#39;s content, create new ones</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'tmpsets/set/mod001-core/all/references.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_references_out'>update_references_out</span>
  <span class='id identifier rubyid_delete_references_out'>delete_references_out</span>
  <span class='id identifier rubyid_create_references_out'>create_references_out</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Aug 15 15:39:46 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-2.3.0).
</div>

    </div>
  </body>
</html>