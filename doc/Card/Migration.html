<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Card::Migration
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Card/Migration.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Card.html" title="Card (class)">Card</a></span></span>
     &raquo; 
    <span class="title">Migration</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Card::Migration
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">ActiveRecord::Migration</span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">ActiveRecord::Migration</li>
          
            <li class="next">Card::Migration</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">card/lib/card/migration.rb</dd>
  
</dl>
<div class="clear"></div>

<div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="CoreMigration.html" title="Card::CoreMigration (class)">CoreMigration</a></span></p>
</div>







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assume_migrated_upto_version-class_method" title="assume_migrated_upto_version (class method)">+ (Object) <strong>assume_migrated_upto_version</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#data_path-class_method" title="data_path (class method)">+ (Object) <strong>data_path</strong>(filename = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_unused_name-class_method" title="find_unused_name (class method)">+ (Object) <strong>find_unused_name</strong>(base_name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#migration_paths-class_method" title="migration_paths (class method)">+ (Object) <strong>migration_paths</strong>(mig_type = type) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#schema-class_method" title="schema (class method)">+ (Object) <strong>schema</strong>(mig_type = type) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#schema_mode-class_method" title="schema_mode (class method)">+ (Object) <strong>schema_mode</strong>(mig_type = type) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#schema_suffix-class_method" title="schema_suffix (class method)">+ (Object) <strong>schema_suffix</strong>(mig_type = type) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#type-class_method" title="type (class method)">+ (Object) <strong>type</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Rake tasks use class methods, migrations use instance methods.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#contentedly-instance_method" title="#contentedly (instance method)">- (Object) <strong>contentedly</strong>(&amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#data_path-instance_method" title="#data_path (instance method)">- (Object) <strong>data_path</strong>(filename = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#down-instance_method" title="#down (instance method)">- (Object) <strong>down</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#import_json-instance_method" title="#import_json (instance method)">- (Object) <strong>import_json</strong>(filename, merge_opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#migrate-instance_method" title="#migrate (instance method)">- (Object) <strong>migrate</strong>(direction) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute this migration in the named direction copied from ActiveRecord to
wrap “up” in “contentendly”.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#migration_paths-instance_method" title="#migration_paths (instance method)">- (Object) <strong>migration_paths</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_json-instance_method" title="#read_json (instance method)">- (Object) <strong>read_json</strong>(filename) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#schema_mode-instance_method" title="#schema_mode (instance method)">- (Object) <strong>schema_mode</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="assume_migrated_upto_version-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>assume_migrated_upto_version</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 49</span>

<span class='kw'>def</span> <span class='id identifier rubyid_assume_migrated_upto_version'>assume_migrated_upto_version</span>
  <span class='id identifier rubyid_schema_mode'>schema_mode</span> <span class='kw'>do</span>
    <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Schema</span><span class='period'>.</span><span class='id identifier rubyid_assume_migrated_upto_version'>assume_migrated_upto_version</span> <span class='id identifier rubyid_schema'>schema</span><span class='comma'>,</span> <span class='id identifier rubyid_migration_paths'>migration_paths</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="data_path-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>data_path</strong>(filename = nil) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 55</span>

<span class='kw'>def</span> <span class='id identifier rubyid_data_path'>data_path</span> <span class='id identifier rubyid_filename'>filename</span><span class='op'>=</span><span class='kw'>nil</span>
  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_migration_paths'>migration_paths</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_migration_paths'>migration_paths</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>data</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_filename'>filename</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_unused_name-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>find_unused_name</strong>(base_name) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20
21
22
23
24
25
26</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 18</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_unused_name'>find_unused_name</span> <span class='id identifier rubyid_base_name'>base_name</span>
  <span class='id identifier rubyid_test_name'>test_name</span> <span class='op'>=</span> <span class='id identifier rubyid_base_name'>base_name</span>
  <span class='id identifier rubyid_add'>add</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='kw'>while</span> <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_test_name'>test_name</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_test_name'>test_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_base_name'>base_name</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_add'>add</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_add'>add</span> <span class='op'>+=</span><span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_test_name'>test_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="migration_paths-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>migration_paths</strong>(mig_type = type) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 28</span>

<span class='kw'>def</span> <span class='id identifier rubyid_migration_paths'>migration_paths</span> <span class='id identifier rubyid_mig_type'>mig_type</span><span class='op'>=</span><span class='id identifier rubyid_type'>type</span>
  <span class='const'>Cardio</span><span class='period'>.</span><span class='id identifier rubyid_migration_paths'>migration_paths</span> <span class='id identifier rubyid_mig_type'>mig_type</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="schema-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>schema</strong>(mig_type = type) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


32
33
34</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 32</span>

<span class='kw'>def</span> <span class='id identifier rubyid_schema'>schema</span> <span class='id identifier rubyid_mig_type'>mig_type</span><span class='op'>=</span><span class='id identifier rubyid_type'>type</span>
  <span class='const'>Cardio</span><span class='period'>.</span><span class='id identifier rubyid_schema'>schema</span> <span class='id identifier rubyid_mig_type'>mig_type</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="schema_mode-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>schema_mode</strong>(mig_type = type) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


40
41
42
43
44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 40</span>

<span class='kw'>def</span> <span class='id identifier rubyid_schema_mode'>schema_mode</span> <span class='id identifier rubyid_mig_type'>mig_type</span><span class='op'>=</span><span class='id identifier rubyid_type'>type</span>
  <span class='id identifier rubyid_new_suffix'>new_suffix</span> <span class='op'>=</span> <span class='id identifier rubyid_schema_suffix'>schema_suffix</span> <span class='id identifier rubyid_mig_type'>mig_type</span>
  <span class='id identifier rubyid_original_suffix'>original_suffix</span> <span class='op'>=</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_table_name_suffix'>table_name_suffix</span>

  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_table_name_suffix'>table_name_suffix</span> <span class='op'>=</span> <span class='id identifier rubyid_new_suffix'>new_suffix</span>
  <span class='kw'>yield</span>
  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_table_name_suffix'>table_name_suffix</span> <span class='op'>=</span> <span class='id identifier rubyid_original_suffix'>original_suffix</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="schema_suffix-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>schema_suffix</strong>(mig_type = type) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 36</span>

<span class='kw'>def</span> <span class='id identifier rubyid_schema_suffix'>schema_suffix</span> <span class='id identifier rubyid_mig_type'>mig_type</span><span class='op'>=</span><span class='id identifier rubyid_type'>type</span>
  <span class='const'>Cardio</span><span class='period'>.</span><span class='id identifier rubyid_schema_suffix'>schema_suffix</span> <span class='id identifier rubyid_mig_type'>mig_type</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="type-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>type</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Rake tasks use class methods, migrations use instance methods. To avoid
repetition a lot of instance methods here just call class methods. The
subclass Card::CoreMigration needs a different @type so we can&#39;t use a
class variable @@type. It has to be a class instance variable. Migrations
are subclasses of Card::Migration or Card::CoreMigration but they don&#39;t
inherit the @type. The method below solves this problem.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


14
15
16</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 14</span>

<span class='kw'>def</span> <span class='id identifier rubyid_type'>type</span>
  <span class='ivar'>@type</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='id identifier rubyid_ancestors'>ancestors</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_ancestors'>ancestors</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="contentedly-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>contentedly</strong>(&amp;block) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_contentedly'>contentedly</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>
  <span class='const'>Card</span><span class='op'>::</span><span class='const'>Cache</span><span class='period'>.</span><span class='id identifier rubyid_reset_global'>reset_global</span>
  <span class='const'>Cardio</span><span class='period'>.</span><span class='id identifier rubyid_schema_mode'>schema_mode</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='const'>Card</span><span class='op'>::</span><span class='const'>Auth</span><span class='period'>.</span><span class='id identifier rubyid_as_bot'>as_bot</span> <span class='kw'>do</span>
      <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
        <span class='kw'>begin</span>
          <span class='kw'>yield</span>
        <span class='kw'>ensure</span>
          <span class='const'>Card</span><span class='op'>::</span><span class='const'>Cache</span><span class='period'>.</span><span class='id identifier rubyid_reset_global'>reset_global</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="data_path-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>data_path</strong>(filename = nil) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 89</span>

<span class='kw'>def</span> <span class='id identifier rubyid_data_path'>data_path</span> <span class='id identifier rubyid_filename'>filename</span><span class='op'>=</span><span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_data_path'>data_path</span> <span class='id identifier rubyid_filename'>filename</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="down-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>down</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::IrreversibleMigration</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


145
146
147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 145</span>

<span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>IrreversibleMigration</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="import_json-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>import_json</strong>(filename, merge_opts = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


77
78
79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 77</span>

<span class='kw'>def</span> <span class='id identifier rubyid_import_json'>import_json</span> <span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_merge_opts'>merge_opts</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_action_mailer'>action_mailer</span><span class='period'>.</span><span class='id identifier rubyid_perform_deliveries'>perform_deliveries</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_merge_opts'>merge_opts</span><span class='period'>.</span><span class='id identifier rubyid_reverse_merge!'>reverse_merge!</span> <span class='symbol'>:output_file</span><span class='op'>=&gt;</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_data_path'>data_path</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unmerged_</span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_filename'>filename</span> <span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_merge_list'>merge_list</span> <span class='id identifier rubyid_read_json'>read_json</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_merge_opts'>merge_opts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="migrate-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>migrate</strong>(direction) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Execute this migration in the named direction copied from ActiveRecord to
wrap “up” in “contentendly”</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 104</span>

<span class='kw'>def</span> <span class='id identifier rubyid_migrate'>migrate</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_direction'>direction</span>
  <span class='kw'>when</span> <span class='symbol'>:up</span>   <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>migrating</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='symbol'>:down</span> <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reverting</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_time'>time</span>   <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_connection_pool'>connection_pool</span><span class='period'>.</span><span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_conn'>conn</span><span class='op'>|</span>
    <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_conn'>conn</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:change</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_direction'>direction</span> <span class='op'>==</span> <span class='symbol'>:down</span>
        <span class='id identifier rubyid_recorder'>recorder</span> <span class='op'>=</span> <span class='const'>CommandRecorder</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@connection</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_suppress_messages'>suppress_messages</span> <span class='kw'>do</span>
          <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_recorder'>recorder</span>
          <span class='id identifier rubyid_change'>change</span>
        <span class='kw'>end</span>
        <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_conn'>conn</span>
        <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'>Benchmark</span><span class='period'>.</span><span class='id identifier rubyid_measure'>measure</span> <span class='lbrace'>{</span>
          <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span>
            <span class='id identifier rubyid_recorder'>recorder</span><span class='period'>.</span><span class='id identifier rubyid_inverse'>inverse</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
              <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
          <span class='rbrace'>}</span>
        <span class='rbrace'>}</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'>Benchmark</span><span class='period'>.</span><span class='id identifier rubyid_measure'>measure</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_change'>change</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'>Benchmark</span><span class='period'>.</span><span class='id identifier rubyid_measure'>measure</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_contentedly'>contentedly</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
    <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_direction'>direction</span>
  <span class='kw'>when</span> <span class='symbol'>:up</span>   <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>migrated (%.4fs)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_time'>time</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span><span class='semicolon'>;</span> <span class='id identifier rubyid_write'>write</span>
  <span class='kw'>when</span> <span class='symbol'>:down</span> <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reverted (%.4fs)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_time'>time</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span><span class='semicolon'>;</span> <span class='id identifier rubyid_write'>write</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="migration_paths-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>migration_paths</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 97</span>

<span class='kw'>def</span> <span class='id identifier rubyid_migration_paths'>migration_paths</span>
  <span class='const'>Cardio</span><span class='period'>.</span><span class='id identifier rubyid_paths'>paths</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_json-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>read_json</strong>(filename) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 83</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_json'>read_json</span> <span class='id identifier rubyid_filename'>filename</span>
  <span class='id identifier rubyid_raw_json'>raw_json</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span> <span class='id identifier rubyid_data_path'>data_path</span> <span class='id identifier rubyid_filename'>filename</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_json'>json</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span> <span class='id identifier rubyid_raw_json'>raw_json</span>
  <span class='id identifier rubyid_json'>json</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>card</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="schema_mode-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>schema_mode</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/migration.rb', line 93</span>

<span class='kw'>def</span> <span class='id identifier rubyid_schema_mode'>schema_mode</span>
  <span class='const'>Cardio</span><span class='period'>.</span><span class='id identifier rubyid_schema_mode'>schema_mode</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu Jul  2 10:29:19 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.5).
</div>

  </body>
</html>