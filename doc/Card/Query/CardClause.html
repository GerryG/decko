<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Card::Query::CardClause
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Card/Query/CardClause.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Card.html" title="Card (class)">Card</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Query.html" title="Card::Query (class)">Query</a></span></span>
     &raquo; 
    <span class="title">CardClause</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Card::Query::CardClause
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Clause.html" title="Card::Query::Clause (class)">Clause</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next"><span class='object_link'><a href="Clause.html" title="Card::Query::Clause (class)">Clause</a></span></li>
          
            <li class="next">Card::Query::CardClause</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">card/lib/card/query/card_clause.rb</dd>
  
</dl>
<div class="clear"></div>


  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="ATTRIBUTES-constant" class="">ATTRIBUTES =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='symbol'>:basic</span>           <span class='op'>=&gt;</span> <span class='qwords_beg'>%w{ </span><span class='tstring_content'>name</span><span class='words_sep'> </span><span class='tstring_content'>type_id</span><span class='words_sep'> </span><span class='tstring_content'>content</span><span class='words_sep'> </span><span class='tstring_content'>id</span><span class='words_sep'> </span><span class='tstring_content'>key</span><span class='words_sep'> </span><span class='tstring_content'>updater_id</span><span class='words_sep'> </span><span class='tstring_content'>left_id</span><span class='words_sep'> </span><span class='tstring_content'>right_id</span><span class='words_sep'> </span><span class='tstring_content'>creator_id</span><span class='words_sep'> </span><span class='tstring_content'>updater_id</span><span class='words_sep'> </span><span class='tstring_content'>codename</span><span class='words_sep'> }</span><span class='comma'>,</span> 
  <span class='symbol'>:relational</span>      <span class='op'>=&gt;</span> <span class='qwords_beg'>%w{ </span><span class='tstring_content'>type</span><span class='words_sep'> </span><span class='tstring_content'>part</span><span class='words_sep'> </span><span class='tstring_content'>left</span><span class='words_sep'> </span><span class='tstring_content'>right</span><span class='words_sep'> </span><span class='tstring_content'>editor_of</span><span class='words_sep'> </span><span class='tstring_content'>edited_by</span><span class='words_sep'> </span><span class='tstring_content'>last_editor_of</span><span class='words_sep'> </span><span class='tstring_content'>last_edited_by</span><span class='words_sep'> </span><span class='tstring_content'>creator_of</span><span class='words_sep'> </span><span class='tstring_content'>created_by</span><span class='words_sep'> </span><span class='tstring_content'>member_of</span><span class='words_sep'> </span><span class='tstring_content'>member</span><span class='words_sep'> }</span><span class='comma'>,</span>
  <span class='symbol'>:plus_relational</span> <span class='op'>=&gt;</span> <span class='qwords_beg'>%w{ </span><span class='tstring_content'>plus</span><span class='words_sep'> </span><span class='tstring_content'>left_plus</span><span class='words_sep'> </span><span class='tstring_content'>right_plus</span><span class='words_sep'> }</span><span class='comma'>,</span>
  <span class='symbol'>:ref_relational</span>  <span class='op'>=&gt;</span> <span class='qwords_beg'>%w{ </span><span class='tstring_content'>refer_to</span><span class='words_sep'> </span><span class='tstring_content'>referred_to_by</span><span class='words_sep'> </span><span class='tstring_content'>link_to</span><span class='words_sep'> </span><span class='tstring_content'>linked_to_by</span><span class='words_sep'> </span><span class='tstring_content'>include</span><span class='words_sep'> </span><span class='tstring_content'>included_by</span><span class='words_sep'> }</span><span class='comma'>,</span>
  <span class='symbol'>:conjunction</span>     <span class='op'>=&gt;</span> <span class='qwords_beg'>%w{ </span><span class='tstring_content'>and</span><span class='words_sep'> </span><span class='tstring_content'>or</span><span class='words_sep'> </span><span class='tstring_content'>all</span><span class='words_sep'> </span><span class='tstring_content'>any</span><span class='words_sep'> }</span><span class='comma'>,</span>
  <span class='symbol'>:special</span>         <span class='op'>=&gt;</span> <span class='qwords_beg'>%w{ </span><span class='tstring_content'>found_by</span><span class='words_sep'> </span><span class='tstring_content'>not</span><span class='words_sep'> </span><span class='tstring_content'>sort</span><span class='words_sep'> </span><span class='tstring_content'>match</span><span class='words_sep'> </span><span class='tstring_content'>complete</span><span class='words_sep'> </span><span class='tstring_content'>extension_type</span><span class='words_sep'> }</span><span class='comma'>,</span>
  <span class='symbol'>:ignore</span>          <span class='op'>=&gt;</span> <span class='qwords_beg'>%w{ </span><span class='tstring_content'>prepend</span><span class='words_sep'> </span><span class='tstring_content'>append</span><span class='words_sep'> </span><span class='tstring_content'>view</span><span class='words_sep'> </span><span class='tstring_content'>params</span><span class='words_sep'> </span><span class='tstring_content'>vars</span><span class='words_sep'> </span><span class='tstring_content'>size</span><span class='words_sep'> }</span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span><span class='id identifier rubyid_pair'>pair</span><span class='op'>|</span> <span class='id identifier rubyid_pair'>pair</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_pair'>pair</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='semicolon'>;</span> <span class='id identifier rubyid_h'>h</span> <span class='rbrace'>}</span></pre></dd>
      
        <dt id="DEFAULT_ORDER_DIRS-constant" class="">DEFAULT_ORDER_DIRS =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span> <span class='symbol'>:update</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>desc</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:relevance</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>desc</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span></pre></dd>
      
        <dt id="CONJUNCTIONS-constant" class="">CONJUNCTIONS =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span> <span class='symbol'>:any</span><span class='op'>=&gt;</span><span class='symbol'>:or</span><span class='comma'>,</span> <span class='symbol'>:in</span><span class='op'>=&gt;</span><span class='symbol'>:or</span><span class='comma'>,</span> <span class='symbol'>:or</span><span class='op'>=&gt;</span><span class='symbol'>:or</span><span class='comma'>,</span> <span class='symbol'>:all</span><span class='op'>=&gt;</span><span class='symbol'>:and</span><span class='comma'>,</span> <span class='symbol'>:and</span><span class='op'>=&gt;</span><span class='symbol'>:and</span> <span class='rbrace'>}</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#join_count-instance_method" title="#join_count (instance method)">- (Object) <strong>join_count</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute join_count.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#joins-instance_method" title="#joins (instance method)">- (Object) <strong>joins</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute joins.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#query-instance_method" title="#query (instance method)">- (Object) <strong>query</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute query.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#rawclause-instance_method" title="#rawclause (instance method)">- (Object) <strong>rawclause</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute rawclause.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#selfname-instance_method" title="#selfname (instance method)">- (Object) <strong>selfname</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute selfname.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#sql-instance_method" title="#sql (instance method)">- (Object) <strong>sql</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute sql.</p>
</div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="Clause.html" title="Card::Query::Clause (class)">Clause</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Clause.html#clause-instance_method" title="Card::Query::Clause#clause (method)">#clause</a></span></p>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build-class_method" title="build (class method)">+ (Object) <strong>build</strong>(query) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#absolute_name-instance_method" title="#absolute_name (instance method)">- (Object) <strong>absolute_name</strong>(name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#action_clause-instance_method" title="#action_clause (instance method)">- (Object) <strong>action_clause</strong>(field, linkfield, val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_join-instance_method" title="#add_join (instance method)">- (Object) <strong>add_join</strong>(name, table, cardfield, otherfield, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#and-instance_method" title="#and (instance method)">- (Object) <strong>and</strong>(val) </a>
    

    
      (also: #all)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>~~~~~~~  CONJUNCTION.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#basic_conditions-instance_method" title="#basic_conditions (instance method)">- (Object) <strong>basic_conditions</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clean-instance_method" title="#clean (instance method)">- (Object) <strong>clean</strong>(query) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clean_val-instance_method" title="#clean_val (instance method)">- (Object) <strong>clean_val</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#complete-instance_method" title="#complete (instance method)">- (Object) <strong>complete</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#conjunction-instance_method" title="#conjunction (instance method)">- (Object) <strong>conjunction</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#created_by-instance_method" title="#created_by (instance method)">- (Object) <strong>created_by</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#creator_of-instance_method" title="#creator_of (instance method)">- (Object) <strong>creator_of</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#current_conjunction-instance_method" title="#current_conjunction (instance method)">- (Object) <strong>current_conjunction</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edited_by-instance_method" title="#edited_by (instance method)">- (Object) <strong>edited_by</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#editor_of-instance_method" title="#editor_of (instance method)">- (Object) <strong>editor_of</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extension_type-instance_method" title="#extension_type (instance method)">- (Object) <strong>extension_type</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#field-instance_method" title="#field (instance method)">- (Object) <strong>field</strong>(name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#field_root-instance_method" title="#field_root (instance method)">- (Object) <strong>field_root</strong>(key) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fields_to_sql-instance_method" title="#fields_to_sql (instance method)">- (Object) <strong>fields_to_sql</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#found_by-instance_method" title="#found_by (instance method)">- (Object) <strong>found_by</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hashify-instance_method" title="#hashify (instance method)">- (Object) <strong>hashify</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#id_from_clause-instance_method" title="#id_from_clause (instance method)">- (Object) <strong>id_from_clause</strong>(clause) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (CardClause) <strong>initialize</strong>(query) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of CardClause.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#junction-instance_method" title="#junction (instance method)">- (Object) <strong>junction</strong>(side, val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_edited_by-instance_method" title="#last_edited_by (instance method)">- (Object) <strong>last_edited_by</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_editor_of-instance_method" title="#last_editor_of (instance method)">- (Object) <strong>last_editor_of</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#left-instance_method" title="#left (instance method)">- (Object) <strong>left</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#left_plus-instance_method" title="#left_plus (instance method)">- (Object) <strong>left_plus</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>~~~~~~ PLUS RELATIONAL.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#match-instance_method" title="#match (instance method)">- (Object) <strong>match</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#member-instance_method" title="#member (instance method)">- (Object) <strong>member</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#member_of-instance_method" title="#member_of (instance method)">- (Object) <strong>member_of</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#merge-instance_method" title="#merge (instance method)">- (Object) <strong>merge</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#not-instance_method" title="#not (instance method)">- (Object) <strong>not</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#or-instance_method" title="#or (instance method)">- (Object) <strong>or</strong>(val) </a>
    

    
      (also: #any)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#part-instance_method" title="#part (instance method)">- (Object) <strong>part</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#permission_conditions-instance_method" title="#permission_conditions (instance method)">- (Object) <strong>permission_conditions</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#plus-instance_method" title="#plus (instance method)">- (Object) <strong>plus</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ready_to_sqlize-instance_method" title="#ready_to_sqlize (instance method)">- (Object) <strong>ready_to_sqlize</strong>(clause) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#refclause-instance_method" title="#refclause (instance method)">- (Object) <strong>refclause</strong>(key, val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#relate-instance_method" title="#relate (instance method)">- (Object) <strong>relate</strong>(subcond, key, val, method) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#restrict-instance_method" title="#restrict (instance method)">- (Object) <strong>restrict</strong>(id_field, val, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#restrict_by_join-instance_method" title="#restrict_by_join (instance method)">- (Object) <strong>restrict_by_join</strong>(id_field, val, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#right-instance_method" title="#right (instance method)">- (Object) <strong>right</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#right_plus-instance_method" title="#right_plus (instance method)">- (Object) <strong>right_plus</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#root-instance_method" title="#root (instance method)">- (Object) <strong>root</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sort-instance_method" title="#sort (instance method)">- (Object) <strong>sort</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sort_field-instance_method" title="#sort_field (instance method)">- (Object) <strong>sort_field</strong>(key, as, dir) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sort_to_sql-instance_method" title="#sort_to_sql (instance method)">- (Object) <strong>sort_to_sql</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#subcondition-instance_method" title="#subcondition (instance method)">- (Object) <strong>subcondition</strong>(val, args = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#table_alias-instance_method" title="#table_alias (instance method)">- (Object) <strong>table_alias</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_sql-instance_method" title="#to_sql (instance method)">- (Object) <strong>to_sql</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#translate_to_attributes-instance_method" title="#translate_to_attributes (instance method)">- (Object) <strong>translate_to_attributes</strong>(clause) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#type-instance_method" title="#type (instance method)">- (Object) <strong>type</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>~~~~~~ RELATIONAL.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Clause.html" title="Card::Query::Clause (class)">Clause</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Clause.html#cast_type-instance_method" title="Card::Query::Clause#cast_type (method)">#cast_type</a></span>, <span class='object_link'><a href="Clause.html#match_prep-instance_method" title="Card::Query::Clause#match_prep (method)">#match_prep</a></span>, <span class='object_link'><a href="Clause.html#quote-instance_method" title="Card::Query::Clause#quote (method)">#quote</a></span>, <span class='object_link'><a href="Clause.html#safe_sql-instance_method" title="Card::Query::Clause#safe_sql (method)">#safe_sql</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Card::Query::CardClause (class)">CardClause</a></span></tt>) <strong>initialize</strong>(query) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of CardClause</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span> <span class='id identifier rubyid_query'>query</span>
  <span class='ivar'>@mods</span> <span class='op'>=</span> <span class='const'>MODIFIERS</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
  <span class='ivar'>@clause</span><span class='comma'>,</span> <span class='ivar'>@joins</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@selfname</span><span class='comma'>,</span> <span class='ivar'>@parent</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='kw'>nil</span>
  <span class='ivar'>@sql</span> <span class='op'>=</span> <span class='const'>SqlStatement</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='ivar'>@query</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
  <span class='ivar'>@query</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span> <span class='ivar'>@query</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:params</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@query</span><span class='lbracket'>[</span><span class='symbol'>:params</span><span class='rbracket'>]</span>
  <span class='ivar'>@vars</span> <span class='op'>=</span> <span class='ivar'>@query</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:vars</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@vars</span><span class='period'>.</span><span class='id identifier rubyid_symbolize_keys!'>symbolize_keys!</span>
  <span class='ivar'>@query</span> <span class='op'>=</span> <span class='id identifier rubyid_clean'>clean</span><span class='lparen'>(</span><span class='ivar'>@query</span><span class='rparen'>)</span>
  <span class='ivar'>@rawclause</span> <span class='op'>=</span> <span class='ivar'>@query</span><span class='period'>.</span><span class='id identifier rubyid_deep_clone'>deep_clone</span>
  
  <span class='ivar'>@sql</span><span class='period'>.</span><span class='id identifier rubyid_distinct'>distinct</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DISTINCT</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='ivar'>@parent</span>

  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="join_count=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="join_count-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>join_count</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute join_count</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_join_count'>join_count</span>
  <span class='ivar'>@join_count</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="joins=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="joins-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>joins</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute joins</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_joins'>joins</span>
  <span class='ivar'>@joins</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="query-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>query</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute query</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_query'>query</span>
  <span class='ivar'>@query</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="rawclause-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>rawclause</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute rawclause</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rawclause'>rawclause</span>
  <span class='ivar'>@rawclause</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="selfname-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>selfname</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute selfname</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_selfname'>selfname</span>
  <span class='ivar'>@selfname</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="sql-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>sql</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute sql</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sql'>sql</span>
  <span class='ivar'>@sql</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="build-class_method">
  
    + (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>build</strong>(query) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25
26</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build'>build</span> <span class='id identifier rubyid_query'>query</span>
  <span class='id identifier rubyid_cardclause'>cardclause</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_query'>query</span>
  <span class='id identifier rubyid_cardclause'>cardclause</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_cardclause'>cardclause</span><span class='period'>.</span><span class='id identifier rubyid_rawclause'>rawclause</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="absolute_name-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>absolute_name</strong>(name) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 82</span>

<span class='kw'>def</span> <span class='id identifier rubyid_absolute_name'>absolute_name</span> <span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\b_</span><span class='regexp_end'>/</span></span> <span class='op'>?</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_name'>to_name</span><span class='period'>.</span><span class='id identifier rubyid_to_absolute'>to_absolute</span><span class='lparen'>(</span><span class='id identifier rubyid_root'>root</span><span class='period'>.</span><span class='id identifier rubyid_selfname'>selfname</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="action_clause-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>action_clause</strong>(field, linkfield, val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


405
406
407
408
409
410</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 405</span>

<span class='kw'>def</span> <span class='id identifier rubyid_action_clause'>action_clause</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_linkfield'>linkfield</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_card_select'>card_select</span> <span class='op'>=</span> <span class='const'>CardClause</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span><span class='symbol'>:_parent</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='comma'>,</span> <span class='symbol'>:return</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sql'>to_sql</span>
  <span class='id identifier rubyid_sql'>sql</span> <span class='op'>=</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(SELECT DISTINCT </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='embexpr_end'>}</span><span class='tstring_content'> AS join_card_id FROM card_acts INNER JOIN card_actions ON card_acts.id = card_act_id </span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_sql'>sql</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> JOIN (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_card_select'>card_select</span><span class='embexpr_end'>}</span><span class='tstring_content'>) AS ss ON </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_linkfield'>linkfield</span><span class='embexpr_end'>}</span><span class='tstring_content'>=ss.id AND (draft is not true))</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_add_join'>add_join</span> <span class='symbol'>:ac</span><span class='comma'>,</span> <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:join_card_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add_join-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>add_join</strong>(name, table, cardfield, otherfield, opts = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


373
374
375
376
377
378
379
380
381
382
383
384
385</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 373</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_join'>add_join</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_cardfield'>cardfield</span><span class='comma'>,</span> <span class='id identifier rubyid_otherfield'>otherfield</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_root'>root</span><span class='period'>.</span><span class='id identifier rubyid_join_count'>join_count</span> <span class='op'>=</span> <span class='id identifier rubyid_root'>root</span><span class='period'>.</span><span class='id identifier rubyid_join_count'>join_count</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>+</span> <span class='int'>1</span>
  <span class='id identifier rubyid_join_alias'>join_alias</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_root'>root</span><span class='period'>.</span><span class='id identifier rubyid_join_count'>join_count</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_on'>on</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cardfield'>cardfield</span><span class='embexpr_end'>}</span><span class='tstring_content'> = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_join_alias'>join_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_otherfield'>otherfield</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'>#is_subselect = !table.is_a?( Symbol )
</span>  
  <span class='kw'>if</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:conj</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>or</span><span class='tstring_end'>&#39;</span></span>  <span class='comment'>#and is_subselect
</span>    <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:side</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LEFT</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='symbol'>:cond</span><span class='rparen'>)</span> <span class='op'>=&gt;</span> <span class='const'>SqlCond</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_on'>on</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='ivar'>@joins</span><span class='lbracket'>[</span><span class='id identifier rubyid_join_alias'>join_alias</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n  </span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:side</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>JOIN</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>AS</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_join_alias'>join_alias</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ON</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_on'>on</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_join_alias'>join_alias</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="and-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>and</strong>(val) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='all-instance_method'>all</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>~~~~~~~  CONJUNCTION</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


257
258
259</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 257</span>

<span class='kw'>def</span> <span class='kw'>and</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_subcondition'>subcondition</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="basic_conditions-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>basic_conditions</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


468
469
470</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 468</span>

<span class='kw'>def</span> <span class='id identifier rubyid_basic_conditions'>basic_conditions</span>
  <span class='ivar'>@clause</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_sql'>to_sql</span> <span class='id identifier rubyid_field_root'>field_root</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_current_conjunction'>current_conjunction</span> <span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clean-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>clean</strong>(query) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55
56
57
58
59
60
61</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 53</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clean'>clean</span> <span class='id identifier rubyid_query'>query</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_symbolize_keys'>symbolize_keys</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:context</span><span class='rparen'>)</span> <span class='kw'>then</span> <span class='ivar'>@selfname</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span> <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:_parent</span><span class='rparen'>)</span> <span class='kw'>then</span> <span class='ivar'>@parent</span>   <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span> <span class='kw'>end</span>
  <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
    <span class='id identifier rubyid_query'>query</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_clean_val'>clean_val</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_query'>query</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clean_val-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>clean_val</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clean_val'>clean_val</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>when</span> <span class='const'>String</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\$(\w+)$</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='ivar'>@vars</span><span class='lbracket'>[</span><span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_absolute_name'>absolute_name</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>when</span> <span class='const'>Card</span><span class='op'>::</span><span class='const'>Name</span>             <span class='semicolon'>;</span> <span class='id identifier rubyid_clean_val'>clean_val</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_s'>s</span>
  <span class='kw'>when</span> <span class='const'>Hash</span>                   <span class='semicolon'>;</span> <span class='id identifier rubyid_clean'>clean</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>when</span> <span class='const'>Array</span>                  <span class='semicolon'>;</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_clean_val'>clean_val</span> <span class='id identifier rubyid_v'>v</span> <span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='const'>Float</span><span class='comma'>,</span> <span class='const'>Symbol</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>else</span>                        <span class='semicolon'>;</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>BadQuery</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unknown WQL value type: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="complete-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>complete</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


345
346
347
348</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 345</span>

<span class='kw'>def</span> <span class='id identifier rubyid_complete'>complete</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_no_plus_card'>no_plus_card</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='op'>=~</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\+</span><span class='regexp_end'>/</span></span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>and right_id is null</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#FIXME -- this should really be more nuanced -- it breaks down after one plus
</span>  <span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='symbol'>:cond</span><span class='rparen'>)</span> <span class='op'>=&gt;</span> <span class='const'>SqlCond</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> lower(name) LIKE lower(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_quote'>quote</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='op'>+</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>) </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_no_plus_card'>no_plus_card</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="conjunction-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>conjunction</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


170
171
172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 170</span>

<span class='kw'>def</span> <span class='id identifier rubyid_conjunction'>conjunction</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>if</span> <span class='lbracket'>[</span><span class='const'>String</span><span class='comma'>,</span> <span class='const'>Symbol</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_member?'>member?</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span>
    <span class='const'>CONJUNCTIONS</span><span class='lbracket'>[</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="created_by-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>created_by</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


222
223
224</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 222</span>

<span class='kw'>def</span> <span class='id identifier rubyid_created_by'>created_by</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_restrict'>restrict</span> <span class='symbol'>:creator_id</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="creator_of-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>creator_of</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 218</span>

<span class='kw'>def</span> <span class='id identifier rubyid_creator_of'>creator_of</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_restrict_by_join'>restrict_by_join</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:return</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>creator_id</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="current_conjunction-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>current_conjunction</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


472
473
474</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 472</span>

<span class='kw'>def</span> <span class='id identifier rubyid_current_conjunction'>current_conjunction</span>
  <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:conj</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>?</span> <span class='symbol'>:and</span> <span class='op'>:</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:conj</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="edited_by-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>edited_by</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 206</span>

<span class='kw'>def</span> <span class='id identifier rubyid_edited_by'>edited_by</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_action_clause'>action_clause</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>card_actions.card_id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:actor_id</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="editor_of-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>editor_of</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


202
203
204</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 202</span>

<span class='kw'>def</span> <span class='id identifier rubyid_editor_of'>editor_of</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_action_clause'>action_clause</span> <span class='symbol'>:actor_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>card_actions.card_id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extension_type-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>extension_type</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


350
351
352
353
354</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 350</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extension_type'>extension_type</span> <span class='id identifier rubyid_val'>val</span>
  <span class='comment'># DEPRECATED LONG AGO!!!
</span>  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>using DEPRECATED extension_type in WQL</span><span class='tstring_end'>&quot;</span></span> 
  <span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='symbol'>:right_plus</span><span class='rparen'>)</span> <span class='op'>=&gt;</span> <span class='const'>AccountID</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="field-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>field</strong>(name) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


387
388
389
390
391
392</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 387</span>

<span class='kw'>def</span> <span class='id identifier rubyid_field'>field</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@fields</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@fields</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='ivar'>@fields</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_name'>name</span> <span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span> <span class='ivar'>@fields</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="field_root-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>field_root</strong>(key) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


394
395
396</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 394</span>

<span class='kw'>def</span> <span class='id identifier rubyid_field_root'>field_root</span> <span class='id identifier rubyid_key'>key</span>
  <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\_\d+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fields_to_sql-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>fields_to_sql</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


484
485
486
487
488
489
490
491
492
493
494</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 484</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fields_to_sql'>fields_to_sql</span>
  <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span>
  <span class='kw'>case</span> <span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>?</span> <span class='symbol'>:card</span> <span class='op'>:</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:raw</span><span class='semicolon'>;</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.*</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='symbol'>:card</span><span class='semicolon'>;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.name</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='symbol'>:count</span><span class='semicolon'>;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coalesce(count(*),0) as count</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='symbol'>:content</span><span class='semicolon'>;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.db_content</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='const'>ATTRIBUTES</span><span class='lbracket'>[</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='op'>==</span><span class='symbol'>:basic</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_safe_sql'>safe_sql</span><span class='lparen'>(</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="found_by-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>found_by</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 270</span>

<span class='kw'>def</span> <span class='id identifier rubyid_found_by'>found_by</span> <span class='id identifier rubyid_val'>val</span>

  <span class='id identifier rubyid_cards'>cards</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='const'>Hash</span><span class='op'>===</span><span class='id identifier rubyid_val'>val</span>
    <span class='const'>Query</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span>
  <span class='kw'>else</span>
    <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_absolute_name'>absolute_name</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:new</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cards'>cards</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;&amp;</span> <span class='lbracket'>[</span><span class='const'>SearchTypeID</span><span class='comma'>,</span><span class='const'>SetID</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_type_id'>type_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>BadQuery</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>%{</span><span class='tstring_content'>&quot;found_by&quot; value needs to be valid Search, but </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is a </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_type_name'>type_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>}</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_restrict_by_join'>restrict_by_join</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='const'>CardClause</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get_query'>get_query</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rawclause'>rawclause</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hashify-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>hashify</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 100</span>

<span class='kw'>def</span> <span class='id identifier rubyid_hashify'>hashify</span> <span class='id identifier rubyid_s'>s</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_s'>s</span>
    <span class='kw'>when</span> <span class='const'>String</span><span class='semicolon'>;</span>   <span class='lbrace'>{</span> <span class='symbol'>:key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_to_name'>to_name</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='rbrace'>}</span>
    <span class='kw'>when</span> <span class='const'>Integer</span><span class='semicolon'>;</span>  <span class='lbrace'>{</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_s'>s</span>              <span class='rbrace'>}</span>
    <span class='kw'>when</span> <span class='const'>Hash</span><span class='semicolon'>;</span>     <span class='id identifier rubyid_s'>s</span>
    <span class='kw'>else</span><span class='semicolon'>;</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>BadQuery</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid cardclause args </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="id_from_clause-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>id_from_clause</strong>(clause) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


412
413
414
415
416
417</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 412</span>

<span class='kw'>def</span> <span class='id identifier rubyid_id_from_clause'>id_from_clause</span> <span class='id identifier rubyid_clause'>clause</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_clause'>clause</span>
  <span class='kw'>when</span> <span class='const'>Integer</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_clause'>clause</span>
  <span class='kw'>when</span> <span class='const'>String</span>  <span class='semicolon'>;</span> <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_fetch_id'>fetch_id</span><span class='lparen'>(</span><span class='id identifier rubyid_clause'>clause</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="junction-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>junction</strong>(side, val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


249
250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 249</span>

<span class='kw'>def</span> <span class='id identifier rubyid_junction'>junction</span> <span class='id identifier rubyid_side'>side</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_part_clause'>part_clause</span><span class='comma'>,</span> <span class='id identifier rubyid_junction_clause'>junction_clause</span> <span class='op'>=</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>:</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='rbracket'>]</span>
  <span class='id identifier rubyid_restrict_by_join'>restrict_by_join</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='id identifier rubyid_junction_clause'>junction_clause</span><span class='comma'>,</span> <span class='id identifier rubyid_side'>side</span><span class='op'>=&gt;</span><span class='id identifier rubyid_part_clause'>part_clause</span><span class='comma'>,</span> <span class='symbol'>:return</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_side'>side</span><span class='op'>==</span><span class='symbol'>:left</span> <span class='op'>?</span> <span class='symbol'>:right</span> <span class='op'>:</span> <span class='symbol'>:left</span><span class='embexpr_end'>}</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="last_edited_by-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>last_edited_by</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 214</span>

<span class='kw'>def</span> <span class='id identifier rubyid_last_edited_by'>last_edited_by</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_restrict'>restrict</span> <span class='symbol'>:updater_id</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="last_editor_of-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>last_editor_of</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_last_editor_of'>last_editor_of</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_restrict_by_join'>restrict_by_join</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:return</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>updater_id</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="left-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>left</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 194</span>

<span class='kw'>def</span> <span class='id identifier rubyid_left'>left</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_restrict'>restrict</span> <span class='symbol'>:left_id</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="left_plus-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>left_plus</strong>(val) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>~~~~~~ PLUS RELATIONAL</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


237
238
239</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 237</span>

<span class='kw'>def</span> <span class='id identifier rubyid_left_plus'>left_plus</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_junction'>junction</span> <span class='symbol'>:left</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="match-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>match</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 325</span>

<span class='kw'>def</span> <span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cxn'>cxn</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_match_prep'>match_prep</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[^</span><span class='embexpr_beg'>#{</span><span class='const'>Card</span><span class='op'>::</span><span class='const'>Name</span><span class='op'>::</span><span class='const'>OK4KEY_RE</span><span class='embexpr_end'>}</span><span class='tstring_content'>]+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    

  <span class='id identifier rubyid_cond'>cond</span> <span class='op'>=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_val_list'>val_list</span> <span class='op'>=</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='id identifier rubyid_name_or_content'>name_or_content</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>replace(</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.name,&#39;+&#39;,&#39; &#39;)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.db_content</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span> 
        <span class='tstring'><span class='tstring_beg'>%{</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_field'>field</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_cxn'>cxn</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span> <span class='id identifier rubyid_quote'>quote</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[[:&lt;:]]</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='embexpr_end'>}</span><span class='tstring_content'>[[:&gt;:]]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='embexpr_end'>}</span><span class='tstring_end'>}</span></span>
      <span class='kw'>end</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name_or_content'>name_or_content</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> OR </span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_val_list'>val_list</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> AND </span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='symbol'>:cond</span><span class='rparen'>)</span><span class='op'>=&gt;</span><span class='const'>SqlCond</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_cond'>cond</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="member-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>member</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


230
231
232</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 230</span>

<span class='kw'>def</span> <span class='id identifier rubyid_member'>member</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='symbol'>:referred_to_by</span><span class='rparen'>)</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:left</span><span class='op'>=&gt;</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:right</span><span class='op'>=&gt;</span><span class='const'>RolesID</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="member_of-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>member_of</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_member_of'>member_of</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='symbol'>:right_plus</span><span class='rparen'>)</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='const'>RolesID</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:refer_to</span><span class='op'>=&gt;</span><span class='id identifier rubyid_val'>val</span><span class='rbrace'>}</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="merge-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>merge</strong>(s) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 92</span>

<span class='kw'>def</span> <span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_s'>s</span>
  <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_hashify'>hashify</span> <span class='id identifier rubyid_s'>s</span>
  <span class='id identifier rubyid_translate_to_attributes'>translate_to_attributes</span> <span class='id identifier rubyid_s'>s</span>
  <span class='id identifier rubyid_ready_to_sqlize'>ready_to_sqlize</span> <span class='id identifier rubyid_s'>s</span>
  <span class='ivar'>@clause</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span> <span class='id identifier rubyid_s'>s</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="not-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>not</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


288
289
290
291
292</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 288</span>

<span class='kw'>def</span> <span class='kw'>not</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_subselect'>subselect</span> <span class='op'>=</span> <span class='const'>CardClause</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span><span class='symbol'>:return</span><span class='op'>=&gt;</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:_parent</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sql'>to_sql</span>
  <span class='id identifier rubyid_join_alias'>join_alias</span> <span class='op'>=</span> <span class='id identifier rubyid_add_join'>add_join</span> <span class='symbol'>:not</span><span class='comma'>,</span> <span class='id identifier rubyid_subselect'>subselect</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:side</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LEFT</span><span class='tstring_end'>&#39;</span></span>        
  <span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='symbol'>:cond</span><span class='rparen'>)</span> <span class='op'>=&gt;</span> <span class='const'>SqlCond</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_join_alias'>join_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.id is null</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="or-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>or</strong>(val) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='any-instance_method'>any</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


262
263
264</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 262</span>

<span class='kw'>def</span> <span class='kw'>or</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_subcondition'>subcondition</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:conj</span><span class='op'>=&gt;</span><span class='symbol'>:or</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="part-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>part</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190
191</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 188</span>

<span class='kw'>def</span> <span class='id identifier rubyid_part'>part</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_right'>right</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='op'>===</span><span class='id identifier rubyid_val'>val</span> <span class='op'>?</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>:</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
  <span class='id identifier rubyid_subcondition'>subcondition</span> <span class='symbol'>:left</span><span class='op'>=&gt;</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:right</span><span class='op'>=&gt;</span><span class='id identifier rubyid_right'>right</span><span class='comma'>,</span> <span class='symbol'>:conj</span><span class='op'>=&gt;</span><span class='symbol'>:or</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="permission_conditions-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>permission_conditions</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


476
477
478
479
480
481
482</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 476</span>

<span class='kw'>def</span> <span class='id identifier rubyid_permission_conditions'>permission_conditions</span>
  <span class='kw'>unless</span> <span class='const'>Auth</span><span class='period'>.</span><span class='id identifier rubyid_always_ok?'>always_ok?</span> <span class='comment'>#or ( Card::Query.root_perms_only &amp;&amp; !root? )
</span>    <span class='id identifier rubyid_read_rules'>read_rules</span> <span class='op'>=</span> <span class='const'>Auth</span><span class='period'>.</span><span class='id identifier rubyid_as_card'>as_card</span><span class='period'>.</span><span class='id identifier rubyid_read_rules'>read_rules</span>
    <span class='id identifier rubyid_read_rule_list'>read_rule_list</span> <span class='op'>=</span> <span class='id identifier rubyid_read_rules'>read_rules</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='id identifier rubyid_read_rules'>read_rules</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.read_rule_id IN (</span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_read_rule_list'>read_rule_list</span> <span class='embexpr_end'>}</span><span class='tstring_content'>))</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>      
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="plus-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>plus</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


245
246
247</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 245</span>

<span class='kw'>def</span> <span class='id identifier rubyid_plus'>plus</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_any'>any</span><span class='lparen'>(</span> <span class='lbrace'>{</span> <span class='symbol'>:left_plus</span><span class='op'>=&gt;</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:right_plus</span><span class='op'>=&gt;</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_deep_clone'>deep_clone</span> <span class='rbrace'>}</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ready_to_sqlize-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>ready_to_sqlize</strong>(clause) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 127</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ready_to_sqlize'>ready_to_sqlize</span> <span class='id identifier rubyid_clause'>clause</span>
  <span class='id identifier rubyid_clause'>clause</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
    <span class='id identifier rubyid_keyroot'>keyroot</span> <span class='op'>=</span> <span class='id identifier rubyid_field_root'>field_root</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_keyroot'>keyroot</span><span class='op'>==</span><span class='symbol'>:cond</span>                            <span class='comment'># internal SQL cond (already ready)
</span>    <span class='kw'>elsif</span> <span class='const'>ATTRIBUTES</span><span class='lbracket'>[</span><span class='id identifier rubyid_keyroot'>keyroot</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='symbol'>:basic</span>          <span class='comment'># sqlize knows how to handle these keys; just process value
</span>      <span class='id identifier rubyid_clause'>clause</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ValueClause</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>else</span>                                         <span class='comment'># keys need additional processing
</span>      <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_clause'>clause</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='id identifier rubyid_key'>key</span>
      <span class='id identifier rubyid_is_array'>is_array</span> <span class='op'>=</span> <span class='const'>Array</span><span class='op'>===</span><span class='id identifier rubyid_val'>val</span>
      <span class='kw'>case</span> <span class='const'>ATTRIBUTES</span><span class='lbracket'>[</span><span class='id identifier rubyid_keyroot'>keyroot</span><span class='rbracket'>]</span>
        <span class='kw'>when</span> <span class='symbol'>:ignore</span>                               <span class='comment'>#noop         
</span>        <span class='kw'>when</span> <span class='symbol'>:relational</span><span class='comma'>,</span> <span class='symbol'>:special</span><span class='comma'>,</span> <span class='symbol'>:conjunction</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_relate'>relate</span> <span class='id identifier rubyid_is_array'>is_array</span><span class='comma'>,</span> <span class='id identifier rubyid_keyroot'>keyroot</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:send</span>
        <span class='kw'>when</span> <span class='symbol'>:ref_relational</span>                     <span class='semicolon'>;</span> <span class='id identifier rubyid_relate'>relate</span> <span class='id identifier rubyid_is_array'>is_array</span><span class='comma'>,</span> <span class='id identifier rubyid_keyroot'>keyroot</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:refclause</span>
        <span class='kw'>when</span> <span class='symbol'>:plus_relational</span>
          <span class='comment'># Arrays can have multiple interpretations for these, so we have to look closer...
</span>          <span class='id identifier rubyid_subcond'>subcond</span> <span class='op'>=</span> <span class='id identifier rubyid_is_array'>is_array</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span> <span class='const'>Array</span><span class='op'>===</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>||</span> <span class='id identifier rubyid_conjunction'>conjunction</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span> <span class='rparen'>)</span>
      
                                                   <span class='id identifier rubyid_relate'>relate</span> <span class='id identifier rubyid_subcond'>subcond</span><span class='comma'>,</span> <span class='id identifier rubyid_keyroot'>keyroot</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:send</span>
        <span class='kw'>else</span>                                     <span class='semicolon'>;</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>BadQuery</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid attribute </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="refclause-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>refclause</strong>(key, val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 165</span>

<span class='kw'>def</span> <span class='id identifier rubyid_refclause'>refclause</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>        
  <span class='id identifier rubyid_add_join'>add_join</span> <span class='symbol'>:ref</span><span class='comma'>,</span> <span class='const'>RefClause</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='kw'>self</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sql'>to_sql</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:ref_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="relate-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>relate</strong>(subcond, key, val, method) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


152
153
154
155
156
157
158
159
160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 152</span>

<span class='kw'>def</span> <span class='id identifier rubyid_relate'>relate</span> <span class='id identifier rubyid_subcond'>subcond</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_subcond'>subcond</span>
    <span class='id identifier rubyid_conj'>conj</span> <span class='op'>=</span> <span class='id identifier rubyid_conjunction'>conjunction</span><span class='lparen'>(</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_conjunction'>conjunction</span><span class='lparen'>(</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span> <span class='rparen'>)</span> <span class='op'>:</span> <span class='symbol'>:and</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_conj'>conj</span> <span class='op'>==</span> <span class='id identifier rubyid_current_conjunction'>current_conjunction</span>                <span class='comment'># same conjunction as container, no need for subcondition
</span>      <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_send'>send</span> <span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_send'>send</span> <span class='id identifier rubyid_conj'>conj</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_field'>field</span> <span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='semicolon'>;</span> <span class='id identifier rubyid_h'>h</span> <span class='rbrace'>}</span>  <span class='comment'># subcondition
</span>    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_send'>send</span> <span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="restrict-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>restrict</strong>(id_field, val, opts = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


419
420
421
422
423
424
425</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 419</span>

<span class='kw'>def</span> <span class='id identifier rubyid_restrict'>restrict</span> <span class='id identifier rubyid_id_field'>id_field</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_id_from_clause'>id_from_clause</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='id identifier rubyid_id_field'>id_field</span><span class='rparen'>)</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_restrict_by_join'>restrict_by_join</span> <span class='id identifier rubyid_id_field'>id_field</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="restrict_by_join-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>restrict_by_join</strong>(id_field, val, opts = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


427
428
429
430
431</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 427</span>

<span class='kw'>def</span> <span class='id identifier rubyid_restrict_by_join'>restrict_by_join</span> <span class='id identifier rubyid_id_field'>id_field</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_reverse_merge!'>reverse_merge!</span><span class='lparen'>(</span><span class='symbol'>:return</span><span class='op'>=&gt;</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:_parent</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_subselect'>subselect</span> <span class='op'>=</span> <span class='const'>CardClause</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sql'>to_sql</span>
  <span class='id identifier rubyid_add_join'>add_join</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>card_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id_field'>id_field</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_subselect'>subselect</span><span class='comma'>,</span> <span class='id identifier rubyid_id_field'>id_field</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="right-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>right</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


198
199
200</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 198</span>

<span class='kw'>def</span> <span class='id identifier rubyid_right'>right</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_restrict'>restrict</span> <span class='symbol'>:right_id</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="right_plus-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>right_plus</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


241
242
243</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 241</span>

<span class='kw'>def</span> <span class='id identifier rubyid_right_plus'>right_plus</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_junction'>junction</span> <span class='symbol'>:right</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="root-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>root</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 78</span>

<span class='kw'>def</span> <span class='id identifier rubyid_root'>root</span>
  <span class='ivar'>@parent</span> <span class='op'>?</span> <span class='ivar'>@parent</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span> <span class='op'>:</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sort-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>sort</strong>(val) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 294</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sort'>sort</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='ivar'>@parent</span>
  <span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id identifier rubyid_safe_sql'>safe_sql</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>db_content</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:item</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>left</span><span class='tstring_end'>&#39;</span></span>

  <span class='kw'>if</span> <span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>count</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_cs_args'>cs_args</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:return</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>count</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:group</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sort_join_field</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:_parent</span><span class='op'>=&gt;</span><span class='kw'>self</span> <span class='rbrace'>}</span>
    <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:sort</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coalesce(count,0)</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># needed for postgres
</span>    <span class='kw'>case</span> <span class='id identifier rubyid_item'>item</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>referred_to</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_join_field'>join_field</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_cs'>cs</span> <span class='op'>=</span> <span class='const'>CardClause</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span> <span class='id identifier rubyid_cs_args'>cs_args</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span> <span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='symbol'>:cond</span><span class='rparen'>)</span><span class='op'>=&gt;</span><span class='const'>SqlCond</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>referer_id in </span><span class='embexpr_beg'>#{</span><span class='const'>CardClause</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='symbol'>:return</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sql'>to_sql</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_cs'>cs</span><span class='period'>.</span><span class='id identifier rubyid_add_join'>add_join</span> <span class='symbol'>:wr</span><span class='comma'>,</span> <span class='symbol'>:card_references</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:referee_id</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>BadQuery</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>count with item: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_item'>item</span><span class='embexpr_end'>}</span><span class='tstring_content'> not yet implemented</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_join_field'>join_field</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_item'>item</span>
      <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>left</span><span class='tstring_end'>&#39;</span></span>  <span class='semicolon'>;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>left_id</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>right</span><span class='tstring_end'>&#39;</span></span> <span class='semicolon'>;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>right_id</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>else</span>         <span class='semicolon'>;</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>BadQuery</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort item: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_item'>item</span><span class='embexpr_end'>}</span><span class='tstring_content'> not yet implemented</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_cs'>cs</span> <span class='op'>=</span> <span class='const'>CardClause</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cs'>cs</span><span class='period'>.</span><span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cs'>cs</span><span class='period'>.</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_join_field'>join_field</span><span class='embexpr_end'>}</span><span class='tstring_content'> as sort_join_field</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_join_table'>join_table</span> <span class='op'>=</span> <span class='id identifier rubyid_add_join'>add_join</span> <span class='symbol'>:sort</span><span class='comma'>,</span> <span class='id identifier rubyid_cs'>cs</span><span class='period'>.</span><span class='id identifier rubyid_to_sql'>to_sql</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:sort_join_field</span><span class='comma'>,</span> <span class='symbol'>:side</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LEFT</span><span class='tstring_end'>&#39;</span></span>
  <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:sort</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_join_table'>join_table</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sort_field-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>sort_field</strong>(key, as, dir) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


510
511
512
513
514
515
516
517
518
519
520
521
522
523
524</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 510</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sort_field'>sort_field</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='id identifier rubyid_dir'>dir</span>
  <span class='id identifier rubyid_order_field'>order_field</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_key'>key</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span>              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.id</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span>          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.updated_at</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>create</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span>          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.created_at</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(name|alpha)$</span><span class='regexp_end'>/</span></span><span class='semicolon'>;</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LOWER( </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.key )</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>content</span><span class='tstring_end'>&#39;</span></span><span class='semicolon'>;</span>         <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.db_content</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>relevance</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span>       <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.updated_at</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#deprecated            
</span>    <span class='kw'>else</span>
      <span class='id identifier rubyid_safe_sql'>safe_sql</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='id identifier rubyid_order_field'>order_field</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CAST(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_order_field'>order_field</span><span class='embexpr_end'>}</span><span class='tstring_content'> AS </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cast_type'>cast_type</span><span class='lparen'>(</span><span class='id identifier rubyid_as'>as</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_as'>as</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_order_field'>order_field</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dir'>dir</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sort_to_sql-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>sort_to_sql</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


496
497
498
499
500
501
502
503
504
505
506
507
508</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 496</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sort_to_sql'>sort_to_sql</span>
  <span class='comment'>#fail &quot;order_key = #{@mods[:sort]}, class = #{order_key.class}&quot;
</span>    
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='ivar'>@parent</span> <span class='kw'>or</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>count</span><span class='tstring_end'>&#39;</span></span> <span class='comment'>#FIXME - extend to all root-only clauses
</span>  <span class='id identifier rubyid_order_key'>order_key</span> <span class='op'>||=</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:sort</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:sort</span><span class='rbracket'>]</span>
    
  <span class='id identifier rubyid_order_directives'>order_directives</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_order_key'>order_key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:dir</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>?</span> <span class='lparen'>(</span><span class='const'>DEFAULT_ORDER_DIRS</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='op'>||</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>asc</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_safe_sql'>safe_sql</span><span class='lparen'>(</span><span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:dir</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='comment'>#wonky
</span>    <span class='id identifier rubyid_sort_field'>sort_field</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:sort_as</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_dir'>dir</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ORDER BY </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_order_directives'>order_directives</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="subcondition-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>subcondition</strong>(val, args = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


398
399
400
401
402
403</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 398</span>

<span class='kw'>def</span> <span class='id identifier rubyid_subcondition'>subcondition</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:return</span><span class='op'>=&gt;</span><span class='symbol'>:condition</span><span class='comma'>,</span> <span class='symbol'>:_parent</span><span class='op'>=&gt;</span><span class='kw'>self</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cardclause'>cardclause</span> <span class='op'>=</span> <span class='const'>CardClause</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span> <span class='id identifier rubyid_args'>args</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_merge'>merge</span> <span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='symbol'>:cond</span><span class='rparen'>)</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cardclause'>cardclause</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span> <span class='id identifier rubyid_cardclause'>cardclause</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="table_alias-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>table_alias</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


362
363
364
365
366
367
368
369
370
371</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 362</span>

<span class='kw'>def</span> <span class='id identifier rubyid_table_alias'>table_alias</span>
  <span class='kw'>case</span>
  <span class='kw'>when</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>condition</span><span class='tstring_end'>&#39;</span></span>
    <span class='ivar'>@parent</span> <span class='op'>?</span> <span class='ivar'>@parent</span><span class='period'>.</span><span class='id identifier rubyid_table_alias'>table_alias</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>t</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='ivar'>@parent</span>
    <span class='ivar'>@parent</span><span class='period'>.</span><span class='id identifier rubyid_table_alias'>table_alias</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span> 
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>t</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_sql-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>to_sql</strong>(*args) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 438</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_sql'>to_sql</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>
  <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_conditions'>conditions</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_basic_conditions'>basic_conditions</span>
  
  <span class='kw'>if</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>condition</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_conds'>conds</span> <span class='op'>=</span> <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_conditions'>conditions</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_conds'>conds</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_conds'>conds</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
    
  <span class='kw'>if</span> <span class='id identifier rubyid_pconds'>pconds</span> <span class='op'>=</span> <span class='id identifier rubyid_permission_conditions'>permission_conditions</span>
    <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_conditions'>conditions</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pconds'>pconds</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span> <span class='id identifier rubyid_fields_to_sql'>fields_to_sql</span>
  <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span> <span class='op'>=</span> <span class='id identifier rubyid_sort_to_sql'>sort_to_sql</span>  <span class='comment'># has side effects!
</span>  <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_tables'>tables</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cards </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span> <span class='op'>+=</span> <span class='ivar'>@joins</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span>

  <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_conditions'>conditions</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_alias'>table_alias</span><span class='embexpr_end'>}</span><span class='tstring_content'>.trash is false</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_group'>group</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GROUP BY </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_safe_sql'>safe_sql</span><span class='lparen'>(</span><span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:group</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:group</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
  <span class='kw'>unless</span> <span class='ivar'>@parent</span> <span class='kw'>or</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:return</span><span class='rbracket'>]</span><span class='op'>==</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>count</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>if</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:limit</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LIMIT </span><span class='embexpr_beg'>#{</span>  <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:limit</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_offset'>offset</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OFFSET </span><span class='embexpr_beg'>#{</span> <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:offset</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='symbol'>:offset</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_sql'>sql</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="translate_to_attributes-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>translate_to_attributes</strong>(clause) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 109</span>

<span class='kw'>def</span> <span class='id identifier rubyid_translate_to_attributes'>translate_to_attributes</span> <span class='id identifier rubyid_clause'>clause</span>
  <span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_clause'>clause</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='symbol'>:_parent</span>
      <span class='ivar'>@parent</span> <span class='op'>=</span> <span class='id identifier rubyid_clause'>clause</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='const'>OPERATORS</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>ATTRIBUTES</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_clause'>clause</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span><span class='id identifier rubyid_val'>val</span><span class='rbracket'>]</span>
    <span class='kw'>elsif</span> <span class='const'>MODIFIERS</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_clause'>clause</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Hash</span>
      <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_clause'>clause</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='id identifier rubyid_key'>key</span>
      <span class='ivar'>@mods</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>?</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>:</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_clause'>clause</span><span class='lbracket'>[</span><span class='symbol'>:content</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_content'>content</span> <span class='kw'>if</span> <span class='id identifier rubyid_content'>content</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="type-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>type</strong>(val) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>~~~~~~ RELATIONAL</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/lib/card/query/card_clause.rb', line 184</span>

<span class='kw'>def</span> <span class='id identifier rubyid_type'>type</span> <span class='id identifier rubyid_val'>val</span>
  <span class='id identifier rubyid_restrict'>restrict</span> <span class='symbol'>:type_id</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu Jul  2 10:29:19 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.5).
</div>

  </body>
</html>