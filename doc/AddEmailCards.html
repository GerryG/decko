<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: AddEmailCards
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!AddEmailCards.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (A)</a> &raquo;
    
    
    <span class="title">AddEmailCards</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: AddEmailCards
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Card/CoreMigration.html" title="Card::CoreMigration (class)">Card::CoreMigration</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">ActiveRecord::Migration</li>
          
            <li class="next"><span class='object_link'><a href="Card/Migration.html" title="Card::Migration (class)">Card::Migration</a></span></li>
          
            <li class="next"><span class='object_link'><a href="Card/CoreMigration.html" title="Card::CoreMigration (class)">Card::CoreMigration</a></span></li>
          
            <li class="next">AddEmailCards</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">card/db/migrate_core_cards/20140629222005_add_email_cards.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#up-instance_method" title="#up (instance method)">- (Object) <strong>up</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Card/Migration.html" title="Card::Migration (class)">Card::Migration</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Card/Migration.html#assume_migrated_upto_version-class_method" title="Card::Migration.assume_migrated_upto_version (method)">assume_migrated_upto_version</a></span>, <span class='object_link'><a href="Card/Migration.html#contentedly-instance_method" title="Card::Migration#contentedly (method)">#contentedly</a></span>, <span class='object_link'><a href="Card/Migration.html#data_path-instance_method" title="Card::Migration#data_path (method)">#data_path</a></span>, <span class='object_link'><a href="Card/Migration.html#data_path-class_method" title="Card::Migration.data_path (method)">data_path</a></span>, <span class='object_link'><a href="Card/Migration.html#down-instance_method" title="Card::Migration#down (method)">#down</a></span>, <span class='object_link'><a href="Card/Migration.html#find_unused_name-class_method" title="Card::Migration.find_unused_name (method)">find_unused_name</a></span>, <span class='object_link'><a href="Card/Migration.html#import_json-instance_method" title="Card::Migration#import_json (method)">#import_json</a></span>, <span class='object_link'><a href="Card/Migration.html#migrate-instance_method" title="Card::Migration#migrate (method)">#migrate</a></span>, <span class='object_link'><a href="Card/Migration.html#migration_paths-instance_method" title="Card::Migration#migration_paths (method)">#migration_paths</a></span>, <span class='object_link'><a href="Card/Migration.html#migration_paths-class_method" title="Card::Migration.migration_paths (method)">migration_paths</a></span>, <span class='object_link'><a href="Card/Migration.html#read_json-instance_method" title="Card::Migration#read_json (method)">#read_json</a></span>, <span class='object_link'><a href="Card/Migration.html#schema-class_method" title="Card::Migration.schema (method)">schema</a></span>, <span class='object_link'><a href="Card/Migration.html#schema_mode-class_method" title="Card::Migration.schema_mode (method)">schema_mode</a></span>, <span class='object_link'><a href="Card/Migration.html#schema_mode-instance_method" title="Card::Migration#schema_mode (method)">#schema_mode</a></span>, <span class='object_link'><a href="Card/Migration.html#schema_suffix-class_method" title="Card::Migration.schema_suffix (method)">schema_suffix</a></span>, <span class='object_link'><a href="Card/Migration.html#type-class_method" title="Card::Migration.type (method)">type</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="up-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>up</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'card/db/migrate_core_cards/20140629222005_add_email_cards.rb', line 4</span>

<span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
  
  <span class='comment'># change notification rules
</span>  <span class='qwords_beg'>%w( </span><span class='tstring_content'>create</span><span class='words_sep'> </span><span class='tstring_content'>update</span><span class='words_sep'> </span><span class='tstring_content'>delete</span><span class='words_sep'> )</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_action'>action</span><span class='op'>|</span>
    <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:type_code</span><span class='op'>=&gt;</span><span class='symbol'>:setting</span><span class='comma'>,</span> <span class='symbol'>:codename</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_content'>+*right+*help</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:content</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Configures email to be sent when card is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_content'>d.</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_action'>action</span><span class='embexpr_end'>}</span><span class='tstring_content'>+*right+*default</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:type_code</span><span class='op'>=&gt;</span><span class='symbol'>:pointer</span>
  <span class='kw'>end</span>
  
  <span class='comment'># change email address list fields to pointers
</span>  <span class='lbracket'>[</span><span class='symbol'>:to</span><span class='comma'>,</span> <span class='symbol'>:from</span><span class='comma'>,</span> <span class='symbol'>:cc</span><span class='comma'>,</span> <span class='symbol'>:bcc</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
    <span class='id identifier rubyid_set'>set</span> <span class='op'>=</span> <span class='const'>Card</span><span class='lbracket'>[</span><span class='id identifier rubyid_field'>field</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:trait</span><span class='op'>=&gt;</span><span class='symbol'>:right</span><span class='comma'>,</span> <span class='symbol'>:new</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_default_rule'>default_rule</span> <span class='op'>=</span> <span class='id identifier rubyid_set'>set</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:trait</span><span class='op'>=&gt;</span><span class='symbol'>:default</span><span class='comma'>,</span> <span class='symbol'>:new</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_default_rule'>default_rule</span><span class='period'>.</span><span class='id identifier rubyid_type_id'>type_id</span> <span class='op'>=</span> <span class='const'>Card</span><span class='op'>::</span><span class='const'>PointerID</span>
    <span class='id identifier rubyid_default_rule'>default_rule</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    
    <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span> <span class='symbol'>:right</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='symbol'>:codename</span><span class='op'>=&gt;</span><span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbrace'>}</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field_card'>field_card</span><span class='op'>|</span>
      <span class='id identifier rubyid_field_card'>field_card</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes!'>update_attributes!</span> <span class='symbol'>:type_id</span> <span class='op'>=&gt;</span> <span class='const'>Card</span><span class='op'>::</span><span class='const'>PointerID</span>
    <span class='kw'>end</span>
    
    <span class='id identifier rubyid_options_rule'>options_rule</span> <span class='op'>=</span> <span class='id identifier rubyid_set'>set</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:trait</span><span class='op'>=&gt;</span><span class='symbol'>:options</span><span class='comma'>,</span> <span class='symbol'>:new</span><span class='op'>=&gt;</span><span class='lbrace'>{</span> <span class='symbol'>:type_code</span><span class='op'>=&gt;</span><span class='symbol'>:search_type</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_options_rule'>options_rule</span><span class='period'>.</span><span class='id identifier rubyid_type_id'>type_id</span> <span class='op'>=</span> <span class='const'>Card</span><span class='op'>::</span><span class='const'>SearchTypeID</span>
    <span class='id identifier rubyid_options_rule'>options_rule</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>%(</span><span class='tstring_content'> { &quot;right_plus&quot;:{&quot;codename&quot;:&quot;account&quot;} } </span><span class='tstring_end'>)</span></span>
    <span class='id identifier rubyid_options_rule'>options_rule</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
  <span class='kw'>end</span>
  
  
  <span class='comment'># create new cardtype for email templates
</span>  <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Email template</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:codename</span><span class='op'>=&gt;</span><span class='symbol'>:email_template</span><span class='comma'>,</span> <span class='symbol'>:type_id</span><span class='op'>=&gt;</span><span class='const'>Card</span><span class='op'>::</span><span class='const'>CardtypeID</span>
  <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Email template+*type+*structure</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:content</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>%(</span><span class='tstring_content'>
{{+</span><span class='embexpr_beg'>#{</span><span class='const'>Card</span><span class='lbracket'>[</span><span class='symbol'>:from</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> | labeled | link}}
{{+</span><span class='embexpr_beg'>#{</span><span class='const'>Card</span><span class='lbracket'>[</span><span class='symbol'>:to</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> | labeled | link}}
{{+</span><span class='embexpr_beg'>#{</span><span class='const'>Card</span><span class='lbracket'>[</span><span class='symbol'>:cc</span>  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> | labeled | link}}
{{+</span><span class='embexpr_beg'>#{</span><span class='const'>Card</span><span class='lbracket'>[</span><span class='symbol'>:bcc</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> | labeled | link}}
{{+*subject | titled}}
{{+*html message | titled}}
{{+*text message | titled}}
{{+*attach | titled}}
</span><span class='tstring_end'>)</span></span>
  
  <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*message</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:new</span><span class='op'>=&gt;</span><span class='lbrace'>{</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>     <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*html message</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_codename'>codename</span> <span class='op'>=</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>html_message</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
  
  <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*text message</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:codename</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text_message</span><span class='tstring_end'>&#39;</span></span>
  <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*text message+*right+*default</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:type_code</span><span class='op'>=&gt;</span><span class='symbol'>:plain_text</span>
  
  
  <span class='const'>Card</span><span class='op'>::</span><span class='const'>Cache</span><span class='period'>.</span><span class='id identifier rubyid_reset_global'>reset_global</span>
  
  
  <span class='comment'># create system email cards
</span>  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='id identifier rubyid_data_path'>data_path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mailer</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_json'>json</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span> <span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mail_config.json</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span> <span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_json'>json</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mail'>mail</span><span class='op'>|</span>
    <span class='id identifier rubyid_mail'>mail</span> <span class='op'>=</span> <span class='id identifier rubyid_mail'>mail</span><span class='period'>.</span><span class='id identifier rubyid_symbolize_keys!'>symbolize_keys!</span>
    <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span> <span class='id identifier rubyid_mail'>mail</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:codename</span><span class='op'>=&gt;</span><span class='id identifier rubyid_mail'>mail</span><span class='lbracket'>[</span><span class='symbol'>:codename</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:type_id</span><span class='op'>=&gt;</span><span class='const'>Card</span><span class='op'>::</span><span class='const'>EmailTemplateID</span>
    <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mail'>mail</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>+*html message</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:content</span><span class='op'>=&gt;</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span> <span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mail'>mail</span><span class='lbracket'>[</span><span class='symbol'>:codename</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>.html</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mail'>mail</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>+*text message</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:content</span><span class='op'>=&gt;</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span> <span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mail'>mail</span><span class='lbracket'>[</span><span class='symbol'>:codename</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>.txt</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mail'>mail</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>+*subject</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:content</span><span class='op'>=&gt;</span><span class='id identifier rubyid_mail'>mail</span><span class='lbracket'>[</span><span class='symbol'>:subject</span><span class='rbracket'>]</span> 
  <span class='kw'>end</span>
  
  
  <span class='comment'># move old hard-coded signup alert email handling to new card-based on_create handling
</span>  <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span><span class='lparen'>(</span>
    <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='lparen'>(</span> <span class='lbracket'>[</span><span class='symbol'>:signup</span><span class='comma'>,</span> <span class='symbol'>:type</span><span class='comma'>,</span> <span class='symbol'>:on_create</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_code'>code</span><span class='op'>|</span> <span class='const'>Card</span><span class='lbracket'>[</span><span class='id identifier rubyid_code'>code</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span> <span class='op'>*</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>+</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='symbol'>:type_id</span><span class='op'>=&gt;</span><span class='const'>Card</span><span class='op'>::</span><span class='const'>PointerID</span><span class='comma'>,</span> <span class='symbol'>:content</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[[signup alert email]]</span><span class='tstring_end'>&quot;</span></span>
  <span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_request_card'>request_card</span> <span class='op'>=</span> <span class='const'>Card</span><span class='lbracket'>[</span><span class='symbol'>:request</span><span class='rbracket'>]</span>
    <span class='lbracket'>[</span><span class='symbol'>:to</span><span class='comma'>,</span> <span class='symbol'>:from</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_old_card'>old_card</span> <span class='op'>=</span> <span class='id identifier rubyid_request_card'>request_card</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:trait</span><span class='op'>=&gt;</span><span class='id identifier rubyid_field'>field</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='op'>!</span><span class='id identifier rubyid_old_card'>old_card</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
        <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signup alert email+</span><span class='embexpr_beg'>#{</span><span class='const'>Card</span><span class='lbracket'>[</span><span class='id identifier rubyid_field'>field</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:content</span><span class='op'>=&gt;</span><span class='id identifier rubyid_old_card'>old_card</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_request_card'>request_card</span><span class='period'>.</span><span class='id identifier rubyid_codename'>codename</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_request_card'>request_card</span><span class='period'>.</span><span class='id identifier rubyid_delete!'>delete!</span>
  <span class='kw'>end</span>
  
  <span class='comment'># update *from settings
</span>  
  <span class='id identifier rubyid_signup_alert_from'>signup_alert_from</span> <span class='op'>=</span> <span class='const'>Card</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signup alert email</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:trait</span><span class='op'>=&gt;</span><span class='symbol'>:from</span><span class='comma'>,</span> <span class='symbol'>:new</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_signup_alert_from'>signup_alert_from</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_signup_alert_from'>signup_alert_from</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_user</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_signup_alert_from'>signup_alert_from</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
  <span class='kw'>end</span>
  
  <span class='id identifier rubyid_wagn_bot'>wagn_bot</span> <span class='op'>=</span> <span class='const'>Card</span><span class='lbracket'>[</span><span class='symbol'>:wagn_bot</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_account'>account</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>?</span> <span class='const'>Card</span><span class='lbracket'>[</span><span class='symbol'>:wagn_bot</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_token_emails_from'>token_emails_from</span> <span class='op'>=</span> <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_setting'>setting</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*invite+*from</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_wagn_bot'>wagn_bot</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_user</span><span class='tstring_end'>&#39;</span></span>
  <span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>verification email</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password reset email</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_token_email_template_name'>token_email_template_name</span><span class='op'>|</span>
    <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_token_email_template_name'>token_email_template_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>+</span><span class='embexpr_beg'>#{</span><span class='const'>Card</span><span class='lbracket'>[</span><span class='symbol'>:from</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:content</span><span class='op'>=&gt;</span><span class='id identifier rubyid_token_emails_from'>token_emails_from</span>
  <span class='kw'>end</span>
  
  <span class='kw'>if</span> <span class='id identifier rubyid_invite_card'>invite_card</span> <span class='op'>=</span> <span class='const'>Card</span><span class='lbracket'>[</span><span class='symbol'>:invite</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_invite_card'>invite_card</span><span class='period'>.</span><span class='id identifier rubyid_codename'>codename</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_invite_card'>invite_card</span><span class='period'>.</span><span class='id identifier rubyid_delete!'>delete!</span>
  <span class='kw'>end</span>
      
  
  <span class='comment'># migrate old flexmail cards
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_email_config_card'>email_config_card</span> <span class='op'>=</span> <span class='const'>Card</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email_config</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span> 
      <span class='symbol'>:left</span><span class='op'>=&gt;</span><span class='lbrace'>{</span> <span class='symbol'>:type_id</span><span class='op'>=&gt;</span><span class='const'>Card</span><span class='op'>::</span><span class='const'>SetID</span> <span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='symbol'>:right</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email_config</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='symbol'>:referred_to_by</span><span class='op'>=&gt;</span><span class='lbrace'>{</span> <span class='symbol'>:right</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='symbol'>:codename</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>send</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span> <span class='rbrace'>}</span> 
    <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_card'>card</span><span class='op'>|</span>
      <span class='id identifier rubyid_set_name'>set_name</span> <span class='op'>=</span> <span class='id identifier rubyid_card'>card</span><span class='period'>.</span><span class='id identifier rubyid_cardname'>cardname</span><span class='period'>.</span><span class='id identifier rubyid_left'>left</span>
      <span class='id identifier rubyid_card'>card</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_set_name'>set_name</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>+</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='embexpr_end'>}</span><span class='tstring_content'>_email_template</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_card'>card</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Email Template</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_card'>card</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
      <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_set_name'>set_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>+*on create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:content</span><span class='op'>=&gt;</span><span class='id identifier rubyid_card'>card</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
    <span class='kw'>end</span>
    
    <span class='id identifier rubyid_email_config_card'>email_config_card</span><span class='period'>.</span><span class='id identifier rubyid_delete!'>delete!</span>
  <span class='kw'>end</span>
  

  <span class='comment'># the new following rule
</span>  <span class='const'>Card</span><span class='period'>.</span><span class='id identifier rubyid_create!'>create!</span> <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*following</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:type_code</span><span class='op'>=&gt;</span><span class='symbol'>:pointer</span><span class='comma'>,</span> <span class='symbol'>:codename</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>following</span><span class='tstring_end'>&#39;</span></span>

  <span class='kw'>if</span> <span class='id identifier rubyid_send'>send</span> <span class='op'>=</span> <span class='const'>Card</span><span class='lbracket'>[</span><span class='symbol'>:send</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_send'>send</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes'>update_attributes</span> <span class='symbol'>:codename</span><span class='op'>=&gt;</span><span class='kw'>nil</span>
    <span class='id identifier rubyid_send'>send</span><span class='period'>.</span><span class='id identifier rubyid_delete!'>delete!</span>
  <span class='kw'>end</span>
  
  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Jun 30 22:28:59 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.5).
</div>

  </body>
</html>